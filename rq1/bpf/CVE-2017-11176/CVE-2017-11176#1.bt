// Monitor the do_mq_notify function for signs of CVE-2017-11176 exploitation

kfunc:vmlinux:do_mq_notify
{
    @in_do_mq_notify[pid] = 1;
}

kretfunc:vmlinux:do_mq_notify
{
    delete(@in_do_mq_notify[pid]);
}

// Track the netlink_attachskb function when called within do_mq_notify
kretfunc:vmlinux:netlink_attachskb
/ @in_do_mq_notify[pid] /
{
    if (retval == 1) {
        printf("CVE-2017-11176 maybe triggered by pid[%d] comm[%s]: netlink_attachskb retry detected\n", pid, comm);
    } else if (retval != 0) {
        printf("CVE-2017-11176 maybe triggered by pid[%d] comm[%s]: netlink_attachskb error\n", pid, comm);
    }
}