#include <linux/sched.h>

tracepoint:syscalls:sys_enter_unshare
/ args->unshare_flags == (CLONE_NEWNS | CLONE_NEWUSER) /
{
    printf("CVE-2021-3493 maybe triggered by pid[%d] comm[%s]\n", pid, comm);
    @active[pid] = 1;
}

tracepoint:syscalls:sys_enter_mount
/ str(args->type) == "overlay" && @active[pid] /
{
    printf("CVE-2021-3493 maybe triggered by pid[%d] comm[%s]\n", pid, comm);
}

tracepoint:syscalls:sys_enter_setxattr
/ str(args->name) == "security.capability" && @active[pid] /
{
    printf("CVE-2021-3493 maybe triggered by pid[%d] comm[%s]\n", pid, comm);
}

tracepoint:syscalls:sys_enter_execve
/ @active[pid] && str(args->filename) == "./ovlcap/upper/magic" /
{
    printf("CVE-2021-3493 maybe triggered by pid[%d] comm[%s]\n", pid, comm);
    delete(@active[pid]);
}