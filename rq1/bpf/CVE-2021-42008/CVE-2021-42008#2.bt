#include <linux/ioctl.h>

#define CVE_ID "CVE-2021-42008"
#define TIOCSETD 0x5423
#define N_6PACK 7

// Fix the initialization of map @fds_by_pid, it doesn't require a specific initialization value
tracepoint:syscalls:sys_enter_ioctl
/args.cmd == TIOCSETD && args.arg == N_6PACK/
{
    @fds_by_pid[pid] = args.fd;
}

tracepoint:syscalls:sys_enter_write
/@fds_by_pid[pid] == args.fd/
{
    printf("%s maybe triggered by pid[%d] comm[%s]\n", CVE_ID, pid, comm);
    delete(@fds_by_pid[pid]);
}