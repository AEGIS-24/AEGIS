#include <linux/socket.h>

kprobe:hci_sock_ioctl
{
    $cmd = arg1; // Extract the command
    $arg = arg2; // Extract the argument

    // Manually define the HCI_SOCK_TRUSTED as 0 (since include file is unavailable)
    $HCI_SOCK_TRUSTED = 0; 

    // Check if the socket is marked as trusted using the defined flag
    if ($cmd & (1 << $HCI_SOCK_TRUSTED)) {
        printf("CVE-2023-2002 potentially triggered by pid[%d] comm[%s]\n", pid, comm);
    }
}