#include <net/bluetooth/bluetooth.h>
#include <net/bluetooth/hci_sock.h>

tracepoint:syscalls:sys_enter_socket
/args->family == PF_BLUETOOTH && args->protocol == BTPROTO_HCI/
{
    @bluetooth_socket[pid] = 1;
}

tracepoint:syscalls:sys_enter_ioctl
/@bluetooth_socket[pid] && args->fd == args->fd/
{
    printf("CVE-2023-2002 maybe triggered by pid[%d] comm[%s]\n", pid, comm);
    delete(@bluetooth_socket[pid]);
}